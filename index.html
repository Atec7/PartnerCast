<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" name="theme-color" content="#FFD700"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="manifest" href="manifest.json" />

  <title>PartnerCast</title>
  <style>

  .whatsapp-btn {
  background-color: #25D366;
  color: white;
  border: none;
  border-radius: 50%;
  width: 42px;
  height: 42px;
  display: inline-flex;
  justify-content: center;
  align-items: center;
  font-size: 20px;
  margin-top: 10px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.whatsapp-btn:hover {
  background-color: #1ebc57;
}


    :root {
      --bg: #121212;
      --green: #00ff88;
      --dark: #1a1a1a;
      --lighter: #333333;
      --highlight: #2bbf7d;
      --white: #f4f4f4;
    }
    h1{
      color: #00ff88;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg);
      color: var(--white);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

   
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: var(--bg);
      color: var(--white);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 9999;
    }

    .progress-bar {
      width: 300px;
      height: 10px;
      background-color: #444;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 20px;
    }

    .progress {
      height: 100%;
      width: 0%;
      background-color: var(--green);
      animation: progressAnimation 3s linear forwards;
    }

    @keyframes progressAnimation {
      0% { width: 0%; }
      100% { width: 100%; }
    }


    header {
      padding: 2em;
      text-align: center;
      color: var(--white);
      
    }

 .episode-list {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 15px;
  padding: 20px 20px;
  max-width: 1200px;
  margin: 0 auto;
}

@media (min-width: 1200px) {
  .episode-list {
    justify-content: flex-start; 
    padding: 20px 40px;
  }
}


.episode {
  background: var(--lighter);
  margin-bottom: 12px; 
  border-radius: 12px;
  width: 400px;
  height: 400px;
  box-shadow: 0 2px 2px rgba(0, 0, 0, 0.2);
  padding: 25px;
  cursor: pointer;
  transition: transform 0.2s ease-in-out;
}


    .episode:hover {
      transform: translateY(-5px);
    }

    .episode img {
      width: 100%;
      height: 230px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .episode h3 {
      font-size: 1.4em;
      color: var(--green);
      margin-bottom: 10px;
      text-align: center;
    }

    .episode p {
      color: #ddd;
      font-size: 0.95em;
      text-align: center;
      margin-bottom: 15px;
    }

    .episode small {
      font-size: 0.9em;
      color: #aaa;
    }

    .like-btn, .comment-btn, .toggle-comments-btn {
      background-color: var(--highlight);
      color: var(--white);
      border: none;
      padding: 8px 15px;
      margin-top: 10px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s;
    }

    .like-btn:hover, .comment-btn:hover, .toggle-comments-btn:hover {
      background: #009e60;
    }

    .comments {
  margin-top: 15px;
  padding: 15px;
  background-color: var(--dark);
  border-radius: 12px;
  width: 100%;
  display: none;
  text-align: left;
  max-height: 200px; 
  overflow-y: auto;
  box-shadow: 0 2px 8px rgba(0,0,0,0.5);
  font-size: 0.95em;
  color: #ccc;
  line-height: 1.4;
}

.comment {
  background-color: #2a2a2a;
  padding: 10px 15px;
  margin-bottom: 10px;
  border-radius: 8px;
  text-align: left;
  box-shadow: inset 0 0 5px rgba(0,0,0,0.6);
  word-wrap: break-word;
  transition: background-color 0.3s ease;
}

.comment:hover {
  background-color: #3d3d3d;
}


    .video-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .video-modal iframe {
      width: 80%;
      height: 80%;
      border: none;
    }

    .video-modal button {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #00ff88;
      color: black;
      border: none;
      padding: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1.5em;
    }
    .logo{
      border-radius: 50%;
      width: 400px;
    }
     #installPrompt {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    border-radius: 30px;
    font-weight: bold;
    z-index: 9999;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 0 10px;
  }

  /* Estilo verde */
  .green-style {
    background: #00ff88;
    color: #000;
    box-shadow: 0 0 10px #00ff88aa;
  }

  /* Estilo preto */
  .black-style {
    background: #121212;
    color: #00ff88;
    box-shadow: 0 0 10px #00ff88aa;
  }
  </style>
</head>
<body>


  <div id="loading-screen">
    <img class="logo" src="logo.png" alt="">
        <h2>Seja Bem-Vindo!</h2>
    <div class="progress-bar">
      <div class="progress"></div>
    </div>
  </div>

  <header>
    <h1>üéß<i>Partner</i>Cast</h1>
    <p>Grupo Partnership - Rio Verde/GO</p>
  </header>
  
  <main id="podcast-list" class="episode-list">

  </main>
<div id="installPrompt" class="green-style">
  Instale o nosso Aplicativo no seu celular!üì≤
</div>
  <div class="video-modal" id="video-modal">
    <button id="close-video-btn">Fechar</button>
    <iframe id="video-player" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
  </div>

  <script>

    window.addEventListener("load", () => {
      setTimeout(() => {
        document.getElementById("loading-screen").style.display = "none";
      }, 3000);
    });
  </script>
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getDatabase, ref, get, set, push } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBBHKGShwjQrny-srWvxXZD9JOnc_K2xFU",
    authDomain: "curtidas-e-coment.firebaseapp.com",
    databaseURL: "https://curtidas-e-coment-default-rtdb.firebaseio.com/",
    projectId: "curtidas-e-coment",
    storageBucket: "curtidas-e-coment.appspot.com",
    messagingSenderId: "660807825414",
    appId: "1:660807825414:web:006d7e7d225032d02a2b87",
    measurementId: "G-1PQBHYB74H"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  function getUserName() {
    let userName = localStorage.getItem('userName');
    if (!userName) {
      userName = prompt('ü§îQual seu nome?');
      if (userName) {
        localStorage.setItem('userName', userName);
      } else {
        userName = 'An√¥nimo';
      }
    }
    return userName;
  }

  function loadEpisodes() {
  const episodesRef = ref(database, 'episodes');
  get(episodesRef).then((snapshot) => {
    if (snapshot.exists()) {
      const episodes = snapshot.val();
      const podcastList = document.getElementById('podcast-list');

      // Limpa a lista antes de adicionar novos epis√≥dios
      podcastList.innerHTML = '';

      // Converte em array e inverte a ordem para mostrar os mais recentes primeiro
      const reversedEpisodes = Object.entries(episodes).reverse();

      for (let [episodeId, episode] of reversedEpisodes) {
        const episodeDiv = document.createElement('div');
        episodeDiv.classList.add('episode');


          const episodeContent = `
            <img src="${episode.imageLink}" alt="Capa do epis√≥dio" class="episode-img" data-episode-id="${episodeId}">
            <h3>${episode.title}</h3>
            <p>${episode.description}</p>
            <small>Likes: <span id="likes-${episodeId}">${episode.likes || 0}</span></small><br>
            <button class="like-btn" data-episode-id="${episodeId}">‚ù§ Curtir</button>
            <button class="comment-btn" data-episode-id="${episodeId}">Comentar</button>
            <button class="toggle-comments-btn" data-episode-id="${episodeId}">Coment√°rios</button>
            <button class="whatsapp-btn" data-episode-id="${episodeId}" title="Compartilhar no WhatsApp">
              <i class="fab fa-whatsapp"></i>
            </button>
            <div class="comments" id="comments-${episodeId}"></div>
          `;

          episodeDiv.innerHTML = episodeContent;
          podcastList.appendChild(episodeDiv);

          episodeDiv.querySelector('.episode-img').addEventListener('click', function () {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('video-player');
            iframe.src = episode.videoLink;
            modal.style.display = 'flex';
          });

          document.getElementById('close-video-btn').addEventListener('click', function () {
            const modal = document.getElementById('video-modal');
            const iframe = document.getElementById('video-player');
            iframe.src = '';
            modal.style.display = 'none';
          });

          episodeDiv.querySelector('.like-btn').addEventListener('click', function () {
            const episodeId = this.getAttribute('data-episode-id');
            addLike(episodeId);
          });

          episodeDiv.querySelector('.comment-btn').addEventListener('click', function () {
            const episodeId = this.getAttribute('data-episode-id');
            const userName = getUserName();
            const commentText = prompt('Escreva seu coment√°rio:');
            if (commentText) {
              addComment(episodeId, userName, commentText);
              loadComments(episodeId);
            }
          });

          episodeDiv.querySelector('.toggle-comments-btn').addEventListener('click', function () {
            const episodeId = this.getAttribute('data-episode-id');
            toggleComments(episodeId);
          });

          episodeDiv.querySelector('.whatsapp-btn').addEventListener('click', function () {
            const episodeId = this.getAttribute('data-episode-id');
            const ep = episodes[episodeId];
            const message = `üéß *Confira esse epis√≥dio incr√≠vel do PartnerCast!*\n\nüìå *${ep.title}*\n\nüëâ Acesse agora: https://atec7.github.io/PartnerCast/`;
            const url = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(url, '_blank');
          });

          loadComments(episodeId);
        }
      }
    });
  }

  function addLike(episodeId) {
    const episodeRef = ref(database, 'episodes/' + episodeId + '/likes');
    get(episodeRef).then((snapshot) => {
      let currentLikes = snapshot.exists() ? snapshot.val() : 0;
      currentLikes += 1;
      set(episodeRef, currentLikes).then(() => {
        document.getElementById(`likes-${episodeId}`).textContent = currentLikes;
      });
    });
  }

  function addComment(episodeId, userName, commentText) {
    const commentsRef = ref(database, 'episodes/' + episodeId + '/comments');
    const newCommentRef = push(commentsRef);
    set(newCommentRef, {
      name: userName,
      text: commentText
    });
  }

  function loadComments(episodeId) {
    const commentsRef = ref(database, 'episodes/' + episodeId + '/comments');
    get(commentsRef).then((snapshot) => {
      const commentsDiv = document.getElementById('comments-' + episodeId);
      commentsDiv.innerHTML = '';
      if (snapshot.exists()) {
        const comments = snapshot.val();
        for (let commentId in comments) {
          const comment = comments[commentId];
          const commentElement = document.createElement('div');
          commentElement.classList.add('comment');
          commentElement.innerHTML = `<strong>${comment.name || 'An√¥nimo'}:</strong> ${comment.text}`;
          commentsDiv.appendChild(commentElement);
        }
      } else {
        commentsDiv.innerHTML = 'Nenhum coment√°rio ainda. Seja o primeiro a comentar!';
      }
    });
  }

  function toggleComments(episodeId) {
    const commentsDiv = document.getElementById('comments-' + episodeId);
    commentsDiv.style.display = commentsDiv.style.display === 'none' ? 'block' : 'none';
  }

  loadEpisodes();
</script>
 <script>
  let deferredPrompt;
  const installPrompt = document.getElementById('installPrompt');

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault(); // Impede que o navegador exiba o banner autom√°tico
    deferredPrompt = e;

    // Mostrar o bot√£o de instala√ß√£o customizado
    installPrompt.style.display = 'block';
  });

  installPrompt.addEventListener('click', async () => {
    installPrompt.style.display = 'none';
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      if (outcome === 'accepted') {
        console.log('Usu√°rio aceitou instalar');
      } else {
        console.log('Usu√°rio recusou instalar');
      }
      deferredPrompt = null;
    }
  });

  // Esconde o bot√£o se o app j√° estiver instalado
  window.addEventListener('appinstalled', () => {
    console.log('App instalado');
    installPrompt.style.display = 'none';
  });
       if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => {
          console.log('‚úÖ Service Worker registrado:', reg.scope);
        })
        .catch(err => {
          console.error('‚ùå Falha ao registrar o Service Worker:', err);
        });
    });
  }
</script>

</body>
</html>
